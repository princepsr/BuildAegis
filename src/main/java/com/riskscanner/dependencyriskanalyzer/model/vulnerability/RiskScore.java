package com.riskscanner.dependencyriskanalyzer.model.vulnerability;

/**
 * Represents a contextual risk score for a vulnerability finding.
 *
 * <p>Combines severity, dependency characteristics, and other factors
 * into a numerical risk score (0-100) with categorical classification.
 */
public class RiskScore {

    private final int score;
    private final RiskLevel riskLevel;
    private final String calculationExplanation;

    public RiskScore(int score, String calculationExplanation) {
        this.score = Math.max(0, Math.min(100, score)); // Clamp to 0-100
        this.riskLevel = determineRiskLevel(this.score);
        this.calculationExplanation = calculationExplanation;
    }

    /**
     * Gets the numerical risk score (0-100).
     */
    public int getScore() {
        return score;
    }

    /**
     * Gets the categorical risk level.
     */
    public RiskLevel getRiskLevel() {
        return riskLevel;
    }

    /**
     * Gets the explanation of how the score was calculated.
     */
    public String getCalculationExplanation() {
        return calculationExplanation;
    }

    /**
     * Determines the risk level based on the numerical score.
     */
    private RiskLevel determineRiskLevel(int score) {
        if (score >= 70) {
            return RiskLevel.HIGH;
        } else if (score >= 40) {
            return RiskLevel.MEDIUM;
        } else {
            return RiskLevel.LOW;
        }
    }

    @Override
    public String toString() {
        return String.format("RiskScore{score=%d, level=%s}", score, riskLevel);
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;

        RiskScore riskScore = (RiskScore) o;
        return score == riskScore.score;
    }

    @Override
    public int hashCode() {
        return Integer.hashCode(score);
    }

    /**
     * Risk level enumeration.
     */
    public enum RiskLevel {
        LOW("Low Risk", 0, 39),
        MEDIUM("Medium Risk", 40, 69),
        HIGH("High Risk", 70, 100);

        private final String displayName;
        private final int minScore;
        private final int maxScore;

        RiskLevel(String displayName, int minScore, int maxScore) {
            this.displayName = displayName;
            this.minScore = minScore;
            this.maxScore = maxScore;
        }

        public String getDisplayName() {
            return displayName;
        }

        public int getMinScore() {
            return minScore;
        }

        public int getMaxScore() {
            return maxScore;
        }

        @Override
        public String toString() {
            return displayName;
        }
    }
}
